trigger:
  # Trigger for pushes on every branch
  batch: true
  branches:
    include:
    - '*'

  # Trigger for all tags
  tags:
    include:
    - '*'

pr:
  # Cancel if new commits are pushed to the same PR
  autoCancel: true

  # Trigger for PRs on all branches
  branches:
    include:
    - '*'

variables:
  # Read deployment variables from our secret group
  - group: deploy-vars

jobs:
- template: build_tools/azure/main.yml
  parameters:
    name: 'Windows_x86_Python35'
    vmImage: 'vs2017-win2016'
    variables:
      python.version: '3.5'
      architecture: 'x86'
    build_pypi: true
    build_conda: false

- template: build_tools/azure/main.yml
  parameters:
    name: 'Windows_x64_Python35'
    vmImage: 'vs2017-win2016'
    variables:
      python.version: '3.5'
      architecture: 'x64'
    build_pypi: true
    build_conda: false

- template: build_tools/azure/main.yml
  parameters:
    name: 'Windows_x86_Python36'
    vmImage: 'vs2017-win2016'
    variables:
      python.version: '3.6'
      architecture: 'x86'
    build_pypi: true
    build_conda: false

- template: build_tools/azure/main.yml
  parameters:
    name: 'Windows_x64_Python36'
    vmImage: 'vs2017-win2016'
    variables:
      python.version: '3.6'
      architecture: 'x64'
    build_pypi: true
    build_conda: false

- template: build_tools/azure/main.yml
  parameters:
    name: 'Windows_x86_Python37'
    vmImage: 'vs2017-win2016'
    variables:
      python.version: '3.7'
      architecture: 'x86'
    build_pypi: true
    build_conda: false

- template: build_tools/azure/main.yml
  parameters:
    name: 'Windows_x64_Python37'
    vmImage: 'vs2017-win2016'
    variables:
      python.version: '3.7'
      architecture: 'x64'
    build_pypi: true
    build_conda: false

- template: build_tools/azure/main.yml
  parameters:
    name: 'macOS_Python35'
    vmImage: 'macOS-10.13'
    variables:
      python.version: '3.5'
      architecture: 'x64'
      PMD_MPL_BACKEND: 'TkAgg'
    build_pypi: true
    build_conda: false

- template: build_tools/azure/main.yml
  parameters:
    name: 'macOS_Python36_and_conda'
    vmImage: 'macOS-10.13'
    variables:
      python.version: '3.6'
      architecture: 'x64'
      PMD_MPL_BACKEND: 'TkAgg'
    build_pypi: true
    build_conda: true

- template: build_tools/azure/main.yml
  parameters:
    name: 'macOS_Python37_and_conda'
    vmImage: 'macOS-10.13'
    variables:
      python.version: '3.7'
      architecture: 'x64'
      PMD_MPL_BACKEND: 'TkAgg'
    build_pypi: true
    build_conda: true

- template: build_tools/azure/main.yml
  parameters:
    name: 'Windows_x64_Python36_just_conda'
    vmImage: 'vs2017-win2016'
    variables:
      python.version: '3.6'
      architecture: 'x64'
    build_pypi: false
    build_conda: true

- template: build_tools/azure/main.yml
  parameters:
    name: 'Windows_x64_Python37_just_conda'
    vmImage: 'vs2017-win2016'
    variables:
      python.version: '3.7'
      architecture: 'x64'
    build_pypi: false
    build_conda: true