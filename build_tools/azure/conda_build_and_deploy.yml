# Have to put the version condition on every step in here, because we can't set conditions on a template
steps:
- bash: |
    pip install jinja2
    mkdir conda
    cd build_tools/azure/conda_scripts
    python render_meta.py
    cd -
  condition: in(variables['python.version'], '3.6', '3.7')
  displayName: 'Rendering meta.yml file'

- script: conda activate base
  condition: and(eq(variables['Agent.OS'], 'Windows_NT'), in(variables['python.version'], '3.6', '3.7'))
  displayName: 'Windows fix'

- script: conda install conda-build --yes
  condition: in(variables['python.version'], '3.6', '3.7')
  displayName: 'Installing conda-build'

- script: conda info
  condition: in(variables['python.version'], '3.6', '3.7')
  displayName: 'Debug info'

#- script: conda create -n buildenv python=$(python.version) --yes
#  displayName: 'Creating conda environment'
#
#- script: call activate buildenv
#  condition: eq(variables['Agent.OS'], 'Windows_NT')
#  displayName: 'Activating conda environment (Windows)'
#
#- bash: source activate buildenv
#  condition: eq(variables['Agent.OS'], 'Darwin')
#  displayName: 'Activating conda environment (macOS)'

- script: conda-build --python=$(python.version) conda/
  condition: in(variables['python.version'], '3.6', '3.7')
  displayName: 'Building and testing conda distribution'
