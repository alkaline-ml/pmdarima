steps:
  - bash: echo "##vso[task.prependpath]$CONDA/bin"
    displayName: 'Add conda to PATH'

  - script: conda install conda-build anaconda-client --yes
    displayName: 'Installing conda-build and anaconda-client'

  - script: python -m pip install --upgrade pip
    displayName: 'Updating pip'

  - script: |
      python -m pip install -r build_tools/build_requirements.txt
      make requirements
    displayName: 'Installing requirements'

  - script: make bdist_wheel
    displayName: 'Building wheel file'

  - bash: |
      mkdir conda
      python -m pip install jinja2
      cd build_tools/azure
      python render_meta.py
      cd -
    displayName: 'Rendering meta.yaml file'

  - bash: conda-build --python=$(python.version) conda/
    condition: ne(variables['Agent.OS'], 'Windows_NT')
    displayName: 'Building and testing conda distribution'

  - script: conda install --use-local pmdarima --yes
    displayName: 'Testing conda installation'