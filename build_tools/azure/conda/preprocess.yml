# This file contains any OS-agnostic conda-related processes
# Have to put the version condition on every step in here, because we can't set conditions on a template
steps:
- bash: |
    mkdir conda
    cd build_tools/azure/conda/scripts
    python render_meta.py
    cd -
  condition: eq(variables['build_conda'], 'true')
  displayName: 'Rendering meta.yml file'

- powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
  condition: and(eq(variables['Agent.OS'], 'Windows_NT'), eq(variables['build_conda'], 'true'))
  displayName: 'Add conda to PATH (Windows)'

- bash: |
    echo "##vso[task.prependpath]$CONDA/bin"
    sudo chown -R $USER $CONDA
  condition: and(eq(variables['Agent.OS'], 'Darwin'), eq(variables['build_conda'], 'true'))
  displayName: 'Add conda to PATH (macOS)'

- script: conda install conda-build --yes
  condition: eq(variables['build_conda'], 'true')
  displayName: 'Installing conda-build'